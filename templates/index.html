<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üöó Used Car Price Predictor</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/static/style.css" />
  <style>
    body {
      background: linear-gradient(135deg, #e6f0ff 0%, #ffffff 100%);
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
      color: #1a202c;
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .glass-card:hover {
      transform: scale(1.01);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      justify-content: center;
      align-items: center;
      z-index: 50;
    }
    .modal-content {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      width: 90%;
      max-width: 600px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
      animation: fadeInUp 0.5s ease;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .gradient-price {
      font-size: 3.5rem;
      font-weight: 800;
      background: linear-gradient(90deg, #22c55e, #16a34a, #15803d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 1px;
      text-shadow: 0 2px 10px rgba(34, 197, 94, 0.25);
    }

    .predict-btn {
      background: linear-gradient(90deg, #2563eb, #3b82f6, #06b6d4);
      color: white;
      font-weight: 700;
      font-size: 1.2rem;
      padding: 0.9rem 3rem;
      border-radius: 1rem;
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
      transition: all 0.3s ease;
    }

    .predict-btn:hover {
      transform: scale(1.07);
      box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
      background: linear-gradient(90deg, #1d4ed8, #2563eb, #0284c7);
    }

    .details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8rem 2rem;
      border-top: 1px solid #e5e7eb;
      padding-top: 1.2rem;
      text-align: left;
    }

    .details-grid p {
      font-size: 0.95rem;
      color: #374151;
      display: flex;
      justify-content: space-between;
    }

    .details-grid strong {
      color: #1e3a8a;
      font-weight: 600;
    }

    @media (max-width: 600px) {
      .details-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <script>
    const brandModels = JSON.parse('{{ brand_model_map | safe }}');

    function updateModels() {
      const brand = document.getElementById("brand").value;
      const modelDropdown = document.getElementById("model_name");
      modelDropdown.innerHTML = "";

      const placeholder = document.createElement("option");
      placeholder.value = "";
      placeholder.textContent = brand ? "Select Model" : "Select Brand First";
      placeholder.disabled = true;
      placeholder.selected = true;
      modelDropdown.appendChild(placeholder);

      if (brand && brandModels[brand]) {
        brandModels[brand].forEach(model => {
          const option = document.createElement("option");
          option.value = model;
          option.textContent = model;
          modelDropdown.appendChild(option);
        });
      }
    }

    function openModal(details, price) {
      const modal = document.getElementById("resultModal");
      const detailList = document.getElementById("carDetails");
      const priceText = document.getElementById("predictedPrice");

      priceText.textContent = price;
      detailList.innerHTML = `
        <div class="details-grid">
          <p><strong>Brand</strong><span>${details.brand}</span></p>
          <p><strong>Model</strong><span>${details.model_name}</span></p>
          <p><strong>Fuel</strong><span>${details.fuel_type}</span></p>
          <p><strong>Transmission</strong><span>${details.transmission}</span></p>
          <p><strong>Seller Type</strong><span>${details.seller_type}</span></p>
          <p><strong>Seats</strong><span>${details.seats}</span></p>
          <p><strong>Age</strong><span>${details.vehicle_age} years</span></p>
          <p><strong>KM Driven</strong><span>${details.km_driven}</span></p>
          <p><strong>Mileage</strong><span>${details.mileage} km/l</span></p>
          <p><strong>Engine</strong><span>${details.engine} cc</span></p>
          <p><strong>Power</strong><span>${details.max_power} bhp</span></p>
        </div>
      `;
      modal.style.display = "flex";
    }

    function closeModal() {
      document.getElementById("resultModal").style.display = "none";
    }

    function validateForm() {
      const requiredFields = document.querySelectorAll("select[required], input[required]");
      for (const field of requiredFields) {
        if (!field.value.trim()) {
          alert("‚ö†Ô∏è Please fill all fields before predicting the price!");
          field.focus();
          return false;
        }
      }
      return true;
    }

    window.onload = () => updateModels();
  </script>
</head>

<body>
  <div class="w-full min-h-screen flex flex-col justify-center items-center px-6">
    <div class="glass-card w-full max-w-6xl p-10 rounded-3xl shadow-2xl">
      <h1 class="text-5xl text-center font-bold mb-3" style="color: #111827; text-shadow: 2px 2px 5px rgba(0,0,0,0.15);">
        üöó Used Car Price Predictor
      </h1>
      <p class="text-center text-gray-600 mb-10 text-lg">Get an AI-based resale price instantly</p>

      <form method="post" action="/predict" class="grid grid-cols-3 gap-6" onsubmit="return validateForm()">
        {% for field in ["brand", "model_name", "seller_type", "fuel_type", "transmission"] %}
        {% endfor %}

        <div>
          <label class="block mb-1 font-medium">üè∑Ô∏è Brand</label>
          <select name="brand" id="brand" class="w-full border p-3 rounded" required onchange="updateModels()">
            <option value="" disabled selected>Select Brand</option>
            {% for brand in brands %}
              <option value="{{brand}}">{{brand}}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="block mb-1 font-medium">üöò Model</label>
          <select name="model_name" id="model_name" class="w-full border p-3 rounded" required>
            <option value="" disabled selected>Select Brand First</option>
          </select>
        </div>

        <div>
          <label class="block mb-1 font-medium">üßæ Seller Type</label>
          <select name="seller_type" class="w-full border p-3 rounded" required>
            <option value="" disabled selected>Select Seller Type</option>
            {% for s in seller_types %}
              <option value="{{s}}">{{s}}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="block mb-1 font-medium">‚õΩ Fuel Type</label>
          <select name="fuel_type" class="w-full border p-3 rounded" required>
            <option value="" disabled selected>Select Fuel Type</option>
            {% for f in fuel_types %}
              <option value="{{f}}">{{f}}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="block mb-1 font-medium">‚öôÔ∏è Transmission</label>
          <select name="transmission" class="w-full border p-3 rounded" required>
            <option value="" disabled selected>Select Transmission</option>
            {% for t in transmissions %}
              <option value="{{t}}">{{t}}</option>
            {% endfor %}
          </select>
        </div>

        <div><label class="block mb-1 font-medium">üí∫ Seats</label><input name="seats" type="number" placeholder="e.g. 5" class="w-full border p-3 rounded" required></div>
        <div><label class="block mb-1 font-medium">üìÖ Age (years)</label><input name="vehicle_age" type="number" placeholder="e.g. 4" class="w-full border p-3 rounded" required></div>
        <div><label class="block mb-1 font-medium">üìç KM Driven</label><input name="km_driven" type="number" placeholder="e.g. 45000" class="w-full border p-3 rounded" required></div>
        <div><label class="block mb-1 font-medium">üö¶ Mileage (km/l)</label><input name="mileage" type="number" step="0.1" placeholder="e.g. 18.5" class="w-full border p-3 rounded" required></div>
        <div><label class="block mb-1 font-medium">üîß Engine (cc)</label><input name="engine" type="number" placeholder="e.g. 1200" class="w-full border p-3 rounded" required></div>
        <div><label class="block mb-1 font-medium">‚ö° Max Power (bhp)</label><input name="max_power" type="number" step="0.1" placeholder="e.g. 82.5" class="w-full border p-3 rounded" required></div>

        <div class="col-span-3 text-center mt-6">
          <button type="submit" class="predict-btn">
            üîÆ Predict Car Price
          </button>
        </div>
      </form>
    </div>
  </div>

  <div id="resultModal" class="modal">
    <div class="modal-content">
      <h2 class="text-3xl font-bold text-blue-700 mb-4">üí∞ Predicted Selling Price</h2>
      <p id="predictedPrice" class="gradient-price mb-4"></p>
      <div id="carDetails" class="text-gray-700"></div>
      <button onclick="closeModal()" class="mt-6 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white py-2 px-8 rounded-lg shadow-md font-semibold transition-all">
        ‚úñ Close
      </button>
    </div>
  </div>

  {% if predicted_price %}
  <script>
    const details = {{ form_data | safe }};
    openModal(details, "{{ predicted_price }}");
  </script>
  {% endif %}
</body>
</html>
